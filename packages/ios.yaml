# Enables Apple iOS Support
ios:
  push:
    categories:
      - name: Alarm
        identifier: 'ALARM'
        actions:
          - identifier: 'DISABLE_ALARM'
            title: 'Disable Alarm'
            activationMode: 'background'
            authenticationRequired: true
            destructive: true
            behavior: 'default'
          - identifier: 'IGNORE_ALARM'
            title: 'Ignore Alarm'
            activationMode: 'background'
            authenticationRequired: false
            destructive: false
            behavior: 'default'
      - name: Camera With Actions
        identifier: 'CAMERA'
        actions:
          - identifier: 'DISABLE_ALARM'
            title: 'Disable Alarm'
            activationMode: 'background'
            authenticationRequired: true
            destructive: true
          - identifier: 'IGNORE_ALARM'
            title: 'Ignore Alarm'
            activationMode: 'background'
            authenticationRequired: false
            destructive: false
      - name: Monitoring
        identifier: 'MONITORING'
        actions:
          - identifier: 'ACK_MONITORING'
            title: 'Acknowledge Alert'
            activationMode: 'background'
            authenticationRequired: false
            destructive: false
          - identifier: 'RESET_MONITORING'
            title: 'Reset Alert'
            activationMode: 'background'
            authenticationRequired: false
            destructive: true
  actions:
    - name: Arm Alarm
      background_color: "#ea3323"
      label:
        text: "Arm Alarm"
        color: "#fcf6e5"
      icon:
        icon: mdi:shield-home
        color: "#fcf6e5"
    - name: Disarm Alarm
      background_color: "#71a737"    
      label:
        text: "Disarm Alarm"
        color: "#fcf6e5"
      icon:
        icon: mdi:shield-check-outline
        color: "#fcf6e5"

script:
  request_location_update_jan:
    alias: Request Location Update Jan
    sequence:
    - data:
        message: request_location_update
      service: notify.mobile_app_iphone12pro_olbrecht_net
  request_location_update_kathrin:
    alias: Request Location Update kathrin
    sequence:
    - data:
        message: request_location_update
      service: notify.mobile_app_iphonexr_olbrecht_net


automation:
  - alias: 'iOS Action: Dismiss Alarm'
    initial_state: 'true'
    trigger:
    - event_data:
        actionName: IGNORE_ALARM
      event_type: ios.notification_action_fired
      platform: event
    action:
    - data:
        message: Alarm dismissed from Phone notification
        title: Alarm ignored
      service: persistent_notification.create
  - alias: 'iOS Action: Disable Alarm'
    initial_state: 'true'
    trigger:
    - event_data:
        actionName: DISABLE_ALARM
      event_type: ios.notification_action_fired
      platform: event
    action:
    - data:
        code: !secret alarm_code
        entity_id: alarm_control_panel.home_alarm
      service: alarm_control_panel.alarm_disarm
  - alias: 'iOS Widget: Arm Alarm'
    initial_state: 'true'
    trigger:
    - event_data:
        actionName: Arm Alarm
      event_type: ios.action_fired
      platform: event
    condition: []
    action:
    - data:
        code: !secret alarm_code
        entity_id: alarm_control_panel.home_alarm
      service: alarm_control_panel.alarm_arm_away
  - alias: 'iOS Widget: Disarm Alarm'
    initial_state: 'true'
    trigger:
    - event_data:
        actionName: Disarm Alarm
      event_type: ios.action_fired
      platform: event
    condition: []
    action:
    - data:
        code: !secret alarm_code
        entity_id: alarm_control_panel.home_alarm
      service: alarm_control_panel.alarm_disarm
  - alias: 'iOS Action: Reset Monitoring'
    initial_state: 'true'
    trigger:
    - event_data:
        actionName: RESET_MONITORING
      event_type: ios.notification_action_fired
      platform: event
    action:
    - data:
        value: ''
        entity_id: input_text.network_monitoring_trigger
      service: input_text.set_value